@model SSY.Models.SignUpUser
@{
    ViewBag.Title = "ChangePassWord";
    Layout = "~/Views/Shared/_LocDashoardLayout.cshtml";
}
<script src="~/Scripts/my_scripts/PassWordStrength.js"></script>
<script>
    var Result = @Html.Raw(Json.Encode(ViewBag.SucessMes))
    var ChangePwd = @Html.Raw(Json.Encode(ViewBag.ChangePwd))
    var Usertype = @Html.Raw(Json.Encode(ViewBag.Usertype))
        
</script>
<script src="~/Scripts/jquery.min.js"></script>
<style type="text/css">
    .input-label {
        text-align: left !important;
        min-width: 130px !important;
    }
    .logo {
        padding: 15px 0;
        font-size: 25px;
        color: #333;
        font-weight: bold;
    }
    .row > div {
        margin-bottom: 0px !important;
    }
    #result {
        margin-left: 5px;
        font-weight: bold;
    }
    #signup .short {
        color: #FF0000;
    }
    #signup .weak {
        color: #E66C2C;
    }
    #signup .good {
        color: #2D98F3;
    }
    #signup .strong {
        color: #006400;
    }
</style>
<br class="clearfix" />
<br class="clearfix" />
@Html.ValidationSummary()
<div class="container">
    <div class="logo" style="text-align: center;">Change Password </div>
    @using (Html.BeginForm("PersonalPassWordChange", "Login", FormMethod.Post, new { onsubmit = "return Validateall()", id = "signup", @class = "form-signin text-left" }))
    {
        @Html.AntiForgeryToken()
        <div class="container-fluid" id="sign">
            <div class="input-group extra-space" style="display:none;">
                <span class="input-group-addon input-label"> Name<span style="color: red"> *</span></span>
                @Html.TextBoxFor(m => m.userid, null, new { @class = "form-control  valid", minlength = "3", maxlength = "50", placeholder = "Name", req = "Req", onkeypress = " return IsCharsOnly(event); ", tabindex = "1" })
            </div>
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="input-group extra-space">
                            <span class="input-group-addon input-label"> Name<span style="color: red"> *</span></span>
                            @Html.TextBoxFor(m => m.Name, null, new { @class = "form-control  valid", minlength = "3", maxlength = "50", placeholder = "Name", req = "Req", onkeypress = " return IsCharsOnly(event); ", tabindex = "1" })
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div class="row" style="display:none;">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="input-group extra-space">
                            <span class="input-group-addon input-label">Designation <span style="color: red">*</span></span>
                            @Html.TextBoxFor(m => m.Designation, null, new { @class = "form-control  valid", placeholder = "Designation", minlength = "3", maxlength = "50", req = "Req", onkeypress = " return IsCharsOnly(event); ", tabindex = "2" })
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="input-group extra-space">
                            <span class="input-group-addon input-label">Old Password <span style="color: red">*</span></span>
                            @Html.TextBoxFor(m => m.OldPassword, null, new { @class = "form-control  valid", placeholder = "Old Password", minlength = "6", maxlength = "12", req = "Req", tabindex = "3", type = "password" })
                        </div>
                    </div>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <div class="form-group">
                        <div class="input-group extra-space">
                            <span class="input-group-addon input-label">New Password <span style="color: red">*</span></span>
                            @Html.TextBoxFor(m => m.NewPassWord, null, new { @class = "form-control  valid chkstrength", placeholder = "New Password", maxlength = "8", tabindex = "3", type = "password" })
                        </div>
                    </div>
                </div>
                <div class="col-md-4"><span id="result"></span></div>
            </div>
            <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4">
                    <center>
                        <button type="submit" id="Save" class="btn btn-sm card-1 inline btn-primary  clearside">Submit</button>
                        <a id="signreset" onclick="ClearAll()" class="btn btn-sm card-1 inline btn-danger  clearside">Clear</a>
                    </center>
                </div>
                <div class="col-md-4"></div>
            </div>
            <div class="row" style="margin-top:10px;">
                <center>

                    <p style="color:maroon;"><b>Note : Password Should Contain Atleast One Special Character , One Digit && One Capital Letter.</b></p>

                </center>
            </div>
        </div>
        <br />
        <br />
    }
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var message = Result;
        
      
        if(Usertype > 7)
            {
        if(ChangePwd ="You have to change your password")
        {
         
            $("#nav").hide();
        }
        }
       
        if(message !="" )
        {
            alert(message);
            window.location.href = "/Home/Logout";
        }
    });
    //$("#Save").click(function(){
    //    $("#OldPassword").val('');
    //    $("#NewPassWord").val('');
    //    window.location.href = "/Home/Logout";
        
    //})
    function Validateall() {
         
        if ($("#Name").val() == "" || $("#Name").val() == null) {
            alert("Please Enter  Name");
            $("#Name").focus();
            return false;
        }
        //if ($("#Designation").val() == "" || $("#Designation").val() == null) {
          //  alert("Please Enter Designation ");
            //$("#Designation").focus();
            //return false;
        //}
        if ($("#OldPassword").val() == "" || $("#OldPassword").val() == null) {
            alert("Please Enter Old Password");
            $("#OldPassword").focus();
            return false;
        }
        if ($("#NewPassWord").val() == "" || $("#NewPassWord").val() == null) {
            alert("Please Enter New Password");
            $("#NewPassWord").focus();
            return false;
        }
        if($("#OldPassword").val() == $("#NewPassWord").val())
        {
            alert("Old Password Same As New Password");
            return false;
        }
        if($("#result").text() !="Strong")
        {
            alert("Password Should Contain Atleast One Special Character , One Digit && One Capital Letter.");
            $("#NewPassWord").focus();
            return false;
        }
        return true;
    }
    $("#GetUserDet").click(function () {
         
        var DeptUserid = $("#DeptUserid").val();
        if (DeptUserid == null || DeptUserid == "") {
            alert("Please Enter User Id...");
            $("#DeptUserid").focus();
            return false;
        }
        $.get('@Url.Action("GetDeptUser", "Login")', { Userid: DeptUserid }, function (Res) {
             
            if (Res == "0") {
                alert("User Details Not Found..");
            }
            else {
                $("#Name").val(Res.Firstname + " " + Res.Lastname);
                $("#Designation").val(Res.Designation);
            }
        });
    });
    function validateEmail() {
        var expr = /^([\w-\.]+)@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
        if (!expr.test($("#Email").val())) {
            alert("Invalid email address.");
            $("#Email").focus();
            return false;
        }
    }
    function IsNumeric(e) {
        var keyCode = e.which ? e.which : e.keyCode
        var ret = ((keyCode >= 48 && keyCode <= 57));
        return ret;
    }
    function IsCharsOnly(e) {
         
        var keyCode = e.keyCode == 0 ? e.charCode : e.keyCode;
        var ret = (((keyCode == 46) || (keyCode == 32) || (keyCode >= 65 && keyCode <= 90) || (keyCode >= 97 && keyCode <= 122)))
        return ret;
    }
    function ClearAll() {
         
     
        
        window.location.href = "/Login/PersonalPassWordChange";
    }
    $('#OldPassword').change(function() {
         
        var uid =   $("#userid").val();
        var oldPassword =   $("#OldPassword").val();
        $.get('@Url.Action("PasswordCheck", "Login")', {uid : uid,oldPassword : oldPassword }, function (dat) {
          
            if(dat !="0")
            {
                alert(dat);
                $("#OldPassword").val("");
                $("#OldPassword").focus();
                return false;
            }
        });
       
    });
</script>