@model SSY.Models.Reports

@{
    ViewBag.Title = "DistrictwiseAgentReportbyAdmin";
    Layout = "~/Views/Shared/_LocDashoardLayout.cshtml";
}



<link href="~/Content/ssy_css/bootstrap-multiselect.css" rel="stylesheet" />
<link href="~/Content/ssy_css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/ssy_css/bootstrap.min.css" rel="stylesheet" />
<script src="~/Scripts/jquery.js"></script>
<script src="~/Content/ssy_js/jquery.dataTables.min.js"></script>
<script src="~/Content/ssy_js/dataTables.bootstrap.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="~/Content/ssy_js/bootstrap-multiselect.js"></script>

<style>
    #fromdate, #todate {
        z-index: 1000;
    }

    .dropdown-toggle, .dropdown-menu {
        width: 200px !important;
    }

    .dataTables_filter {
        margin-left: 280px !important;
    }

    .dataTables_length, .dataTables_filter {
        display: none !important;
    }

    .dropdown-menu {
        position: absolute;
        z-index: 9;
        max-height: 250px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    td {
        font-size: small;
    }
</style>

<script>
    var UserTypeid = @Html.Raw(Json.Encode(ViewBag.usertype));
    var Deptid = @Html.Raw(Json.Encode(ViewBag.deptid));
    var sendloactions = "";
    var RepSubDVision ="";
    var RepLocation ="";
    var SendSubDiv ="";
    var ReportDistrics = "";
    var chekval = 0;

</script>

<div class="container-fliud">
    <div class="" style="text-align: center"><h4><b>Agent Details</b></h4></div>
    <br />
    <div class="row">
        <div class="col-sm-12">
            <div class="col-md-3">
                <div class="form-group">
                    <div class="input-group extra-space">
                        <span class="input-group-addon input-label">District</span>
                        @Html.DropDownListFor(m => m.disid, new SelectList(Model.district, "Value", "Text"), new { @class = "form-control District", @tabindex = "8" })
                    </div>
                </div>
            </div>
            <div class="col-md-3" id="divsub">
                <div class="form-group">
                    <div class="input-group extra-space">
                        <span class="input-group-addon input-label">Sub Division</span>
                        @Html.DropDownListFor(m => m.subdivid, new SelectList(Model.subdivision, "Value", "Text"), new { @class = "form-control", @tabindex = "7" })
                    </div>
                </div>
            </div>
            <div class="col-md-3" id="divloc">
                <div class="form-group">
                    <div class="input-group extra-space">
                        <span class="input-group-addon input-label">Location</span>
                        @Html.DropDownListFor(m => m.muncorp, new SelectList(Model.muncorpname, "Value", "Text"), new { @class = "form-control Location dropdown-menu", id = "Location", @tabindex = "8" })
                    </div>
                </div>
            </div>
         
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
            <div class="col-md-3">
                <div class="form-group">
                    <div class="input-group">
                        <span class="input-group-addon input-label">Status</span>
                        @Html.DropDownList("status", new List<SelectListItem>
                                        {
                                              new SelectListItem{ Text="ALL", Value = "0,1,2" },
                                              new SelectListItem{ Text="Pending", Value = "0" },
                                              new SelectListItem{ Text="Approved", Value = "1" },
                                              new SelectListItem{ Text="Rejected", Value = "2" }
                                        }, new { @class = "form-control" })
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="form-group">
                    <div class="input-group"><a class="btn btn-primary" onclick="GetRepData()">Submit</a></div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12" style="padding-left:60px;padding-right:20px;">
            <div id="divTable" style="display:none;">
                <table class="table table-striped table-bordered TblAgentData" cellspacing="0" width="100%">
                    <thead>
                        <tr>
                            <th>Sl No.</th>
                            <th>Agent Name</th>
                            <th>Role</th>
                            <th>ARN</th>
                            <th>Mobile No.</th>
                            <th>Email ID</th>
                            <th>Address</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>

                <div class="col-lg-2 col-md-2 col-sm-1 pull-right" style="margin-right:-15px;padding-top:5px;">
                    <div class="input-group input-group-sm">
                        <input type="text" id="txtPaging" class="form-control" placeholder="jump to page..">
                        <span class="input-group-btn">
                            <button class="btn btn-primary" type="button" id="btnPaging">Go!</button>
                        </span>
                    </div>
                </div>
            </div>
            <div id="Activeloaderdiv" style="display:none;"> <center><img src="  /Content/images/ColorProcessing.gif" /> </center> </div>


        </div>
    </div>

    <div class="row">
        <div class="col-md-12 column">
            <div class="container-fluid">

                <iframe name="ifr" id="ifr" style="width: 100%;height:500px; position: relative; border: none; margin-bottom:5%;margin-left:50px;margin-right:150px;padding-right:50px; max-height: 400px;overflow-y:auto; border-radius: 0px; "></iframe>
            </div>
        </div>
    </div>
    @*<input type="hidden" id="MultiLoca" value="" name="MultiLoca" />*@
</div>

<script type="text/javascript">

    $(document).ready(function () {

        $('.TblAgentData').DataTable({

        });

		if (UserTypeid == "1" || UserTypeid == "21" || UserTypeid == "22" || UserTypeid == "23" || UserTypeid == "24")
        {
            $("#disid").removeAttr("multiple");

            $("#disid").attr("multiple", "multiple");

            $('#disid').multiselect({
                columns: 3,
                placeholder: 'Select Languages',
                search: true,
                includeSelectAllOption: true
            })

            $("#disid").multiselect('rebuild');

            $('option', $('#disid')).each(function (element) {
                $(this).removeAttr('selected').prop('selected', false);
            });
            $("#disid").multiselect('refresh');

            $("#disid").val("-1");
            $("#subdivid").val("-1");
            $("#Location").val("-1");
        }

        if(UserTypeid == "5")
        {
             
            $("#disid").attr("disabled", true);
            $("#subdivid").attr("disabled", true);

            $.get('@Url.Action("GetMultipleLoca", "Registration")', { Uid: Deptid }, function (dat) {
                $("#Location").find("option").remove();

                $.each(dat, function (i, data) {
                     
                    $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");

                });
                $("#Location").attr("multiple", "multiple");
                $('#Location').multiselect({
                    columns: 3,
                    placeholder: 'Select Languages',
                    search: true,
                    includeSelectAllOption: true
                })
                $("#Location").multiselect('rebuild');

                $('option', $('#Location')).each(function (element) {
                    $(this).removeAttr('selected').prop('selected', false);
                });
                $("#Location").multiselect('refresh');
            });
        }
        if(UserTypeid == "6")
        {
            $("#disid").attr("disabled", true);
            $.get('@Url.Action("GetMultipleSubDiv", "Registration")', { Uid: Deptid }, function (dat) {
                $("#subdivid").find("option").remove();
                //$("#subdivid").append("<option value=-1> " + " -- Select Subdivision --" + " </option>");
                // $("#subdivid").append("<option value=0> " + "ALL" + " </option>");
                RepSubDVision = "";
                $.each(dat, function (i, data) {
                     
                    $("#subdivid").append("<option value=" + data.Value + "> " + data.Text + " </option>");

                    RepSubDVision +=  data.Value +"," ;
                });

                $("#subdivid").removeAttr("multiple");

                $("#subdivid").attr("multiple", "multiple");
                $('#subdivid').multiselect({
                    columns:3,
                    placeholder: 'Select Languages',
                    search: true,
                    includeSelectAllOption: true
                })
                $("#subdivid").multiselect('rebuild');

                
                $('option', $('#subdivid')).each(function (element) {
                    $(this).removeAttr('selected').prop('selected', false);
                });
                $("#subdivid").multiselect('refresh');
            });
        }
        if(UserTypeid == "7" || UserTypeid == "3" || UserTypeid == "4")
        {
            $.get('@Url.Action("GetMultipleDistricts", "Registration")', { Uid: Deptid}, function (dat) {
                 
                var disticts ="";
                $("#disid").find("option").remove();
                //$("#disid").append("<option value="+-1+"> " + " -- Select District --" + " </option>");

                ReportDistrics = "";
                $.each(dat, function (i, data) {
                    $("#disid").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                    ReportDistrics += data.Value+",";
                });

                $("#disid").attr("multiple", "multiple");
                $('#disid').multiselect({
                    columns: 3,
                    placeholder: 'Select Languages',
                    search: true,
                    includeSelectAllOption: true
                })
                $("#disid").multiselect('rebuild');

                $('option', $('#disid')).each(function (element) {
                    $(this).removeAttr('selected').prop('selected', false);
                });
                $("#disid").multiselect('refresh');
            });
        }



        $("#disid").change(loadSubdiv);
        $("#subdivid").change(loadBlock);
    });

    function loadSubdiv() {

        var Districtselected = $("#disid option:selected");
        var Districtmessage="0";
        Districtselected.each(function () {
             
            var res =     $(this).val();

            Districtmessage += ","+$(this).val();
        });

        $.get('@Url.Action("GetDidsSubdivisionJSON", "Report")', {IDs: Districtmessage }, function (dat) {
            $("#subdivid").find("option").remove();
            $.each(dat, function (i, data) {
                 
                $("#subdivid").append("<option value=" + data.Value + "> " + data.Text + " </option>");
            });

            $("#subdivid").removeAttr("multiple");

            $("#subdivid").attr("multiple", "multiple");
            $('#subdivid').multiselect({
                columns:3,
                placeholder: 'Select Languages',
                search: true,
                includeSelectAllOption: true
            })
            $("#subdivid").multiselect('rebuild');

            
            $('option', $('#subdivid')).each(function (element) {
                $(this).removeAttr('selected').prop('selected', false);
            });
            $("#subdivid").multiselect('refresh');

        });
    }


    function loadBlock() {


        var SubDistrictselected = $("#subdivid option:selected");
        var SubDistrictmessage="0";
        SubDistrictselected.each(function () {
             
            var res =     $(this).val();

            SubDistrictmessage += ","+$(this).val();

        });

        $.get('@Url.Action("GetblockforSubRepIdsJSON", "Report")', { IDs: SubDistrictmessage }, function (dat) {
             
            $("#Location").find("option").remove();

            sendloactions = "";
            $.each(dat, function (i, data) {
                 
                if (data.Value != "0")
                    $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                sendloactions += data.Value + ",";
            });
            $("#Location").attr("multiple", "multiple");
            $('#Location').multiselect({
                columns: 3,
                placeholder: 'Select Languages',
                search: true,
                includeSelectAllOption: true
            })
            $("#Location").multiselect('rebuild');

                     
            $('option', $('#Location')).each(function (element) {
                $(this).removeAttr('selected').prop('selected', false);
            });
            $("#Location").multiselect('refresh');
        });

    }

    function GetRepData()
    {

        if ($("#disid").val() == "" || $("#disid").val() == null||$("#disid").val() == "0" ) {
            alert("Please Select District");
            $("#disid").focus();
            return false;
        }


        if ($("#subdivid").val() == "" || $("#subdivid").val() == null||$("#subdivid").val() == "-1" ) {
            alert("Please Select Subdivision");
            $("#subdivid").focus();
            return false;
        }

        if ($("#Location").val() == "" || $("#Location").val() == null||$("#Location").val() == "-1" ) {
            alert("Please Select Location");
            $("#Location").focus();
            return false;
        }



        //  $("#divTable").hide();
        // $("#Activeloaderdiv").show();

        var LocationSelected = $("#Location option:selected");
        var Locationmessage="0";
        LocationSelected.each(function () {
             
            var res =     $(this).val();

            Locationmessage += ","+$(this).val();

        });

        var StatusSelected = $("#status").val();
        //alert(StatusSelected);
        var StatusMsg="";

        //  StatusSelected.each(function (){
        // var res=$(this).val();
        //   StatusMsg+=  res +",";
        //  });

       // alert(Locationmessage);
        //alert(StatusSelected);

        var url = "/SSYIDCard/AgentDetReportByAdmin.aspx?loccodes=" + Locationmessage + "&Status=" + StatusSelected;


        $('iframe#ifr').attr('src', url);

        @*$.get('@Url.Action("GetAgentDetailsByAdmin", "Report")', { IDs: Locationmessage, Status:StatusMsg }, function (result) {
            // 
            var table = $('.TblAgentData').DataTable();
            table.destroy();

            $('.TblAgentData tbody').empty();

            if (Object.keys(result).length > 0) {

                $.each(result, function (i, data) {
                    var num = i + 1;

                    if(data.Status == "Pending")
                        $('.TblAgentData').append('<tr><td>' + num + '</td><td>' + data.AgentName + '</td><td>' + data.Designation + '</td><td>' + data.ARN + '</td><td>' + data.Mobileno + '</td><td>' + data.Email_ID + '</td><td>' + data.Address + '</td><td><font color="#DAA520"><strong>PENDING</strong></font></td></tr>')
                    if(data.Status == "Approved")
                        $('.TblAgentData').append('<tr><td>' + num + '</td><td>' + data.AgentName + '</td><td>' + data.Designation + '</td><td>' + data.ARN + '</td><td>' + data.Mobileno + '</td><td>' + data.Email_ID + '</td><td>' + data.Address + '</td><td><font color="#008000"><strong>APPROVED</strong></font></td></tr>')
                    if(data.Status == "Rejected")
                        $('.TblAgentData').append('<tr><td>' + num + '</td><td>' + data.AgentName + '</td><td>' + data.Designation + '</td><td>' + data.ARN + '</td><td>' + data.Mobileno + '</td><td>' + data.Email_ID + '</td><td>' + data.Address + '</td><td><font color="#FF0000"><strong>REJECTED</strong></font></td></tr>')

                });


                $('.TblAgentData').DataTable({

                    dom: 'Bfrtip',

                    "ordering": false,

                    buttons: [
                        {
                            extend: 'excel',

                            text: 'Download Excel'
                        }
                    ]
                });

                $("#Activeloaderdiv").hide();
                $("#divTable").show();
            }
            else {
                $("#Activeloaderdiv").hide();
                $("#divTable").show();
                $('.TblAgentData').DataTable();
            }

        });*@

    }

    $('#btnPaging').click(function () {

        var val = $('#txtPaging').val();
        if (val != "" && val != 0) {

            val = val - 1;
            var table = $('.TblAgentData').DataTable();
            table.page(parseInt(val)).draw('page');
        }
        else {
            alert('Requested page number not valid');
            $('#txtPaging').focus();
        }
    });

</script>
