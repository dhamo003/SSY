

@{
	ViewBag.Title = "TransWrkrNewUserRenewelApplications";
	Layout = "~/Views/Shared/_LocDashoardLayout.cshtml";
}


<link href="~/Content/ssy_css/dataTables.bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/ssy_css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script src="~/Scripts/jquery.js"></script>
<script src="~/Content/ssy_js/jquery.dataTables.min.js"></script>
<script src="~/Content/ssy_js/dataTables.bootstrap.min.js"></script>

<style>
</style>
<script>
    var deptuserid = @Html.Raw(Json.Encode(ViewBag.deptuserid))
</script>

<div class="container-fluid">

	<form id="additionalInformation">
		<div class="row">
			<div class="col-md-12">
				<center><h3 class="product-description">New Construction Workers WBCWSSS Scheme Renewel Requests</h3></center>
				<div class="row">
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">SSI Number</span>
								@Html.TextBox("benssinumber", "", null, new { @class = "form-control" })
							</div>
						</div>
					</div>
					<div class="col-md-2">
						<a class="btn btn-primary" onclick="GetBenRenwlDet()">Get Bene Renewel Details</a>
					</div>

				</div>
				<div class="row">

					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">SSI Number</span>
								@Html.TextBox("ssinumberdet", "", null, new { @class = "form-control" })
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Beneficiary Name</span>
								@Html.TextBox("Beneficiaryname", "", null, new { @class = "form-control", @readonly = true })
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Registration Number</span>
								@Html.TextBox("regnumber", "", null, new { @class = "form-control", @readonly = true })
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Receipt Book Number</span>
								@Html.TextBox("receiptbookno", "", null, new { @class = "form-control" })
							</div>
						</div>
					</div>
				</div>


				<div class="row">

					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Receipt Number</span>
								@Html.TextBox("Receiptno", "", null, new { @class = "form-control" })
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Registration Date</span>
								@Html.TextBox("registrationdate", "", null, new { @class = "form-control", @readonly = true })
							</div>
						</div>
					</div>
					<div class="col-md-3">
						<div class="form-group">
							<div class="input-group extra-space">
								<span class="input-group-addon input-label">Receipt Amount</span>
								@Html.TextBox("ReceiptAmount", "", null, new { @class = "form-control" })
							</div>
						</div>
					</div>



				</div>

				<div class="row">
					<div class="col-md-6">
						<div class="input-group extra-space">
							@*<label class="">Upload DOB Proof<font size="1"> *</font></label>*@
							<span class="input-group-addon input-label">Upload Scheme Certificate</span>

							<input type="file" multiple="multiple" name="files[0]" class="form-control" id="dobproofdoc" />
							<font size="2"> &nbsp;&nbsp;&nbsp;&nbsp; Scheme Certificate limit is upto 2MB, JPEG/PNG/PDF</font>
							<a href="#" id="dobproofdoc1"><span class="glyphicon glyphicon-remove-circle"></span></a>
						</div>
					</div>
				</div>
				<div class="row" style="margin-top:20px">
					<div class="col-md-12">
						<center><a class="btn btn-primary" onclick="FinalSubmit()">Submit</a></center>
					</div>
				</div>


				<br />
				@*<div>
						<table class="table table-striped table-bordered Apllications" cellspacing="0" width="100%">
							<thead style="background-color:#87CEEB">
								<tr>
									<th>S.No</th>
									<th>Name</th>
									<th>SSIN</th>
									<th>Created Date</th>
									<th>Status</th>
									<th class="th_hide">Remarks</th>
								</tr>
							</thead>
							<tbody></tbody>
						</table>
					</div>*@
			</div>
		</div>

		@*<div class="modal fade" id="DivBenPersonalDet" role="dialog">
				<div class="modal-dialog modal-lg">
					<center>
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal">&times;</button>
								<h4 class="modal-title"></h4>
							</div>
							<div class="modal-body" style="height: 300px;overflow-y: auto;">
								<div class="col-md-6">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th colspan="2">Old Date of Birth Details</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>Date of Birth</td>
												<td><label id="lblNewBeneDOB"></label></td>
											</tr>
										</tbody>
									</table>
									<div class="panel panel-default">
										<div class="panel-heading">
											<h4 class="panel-title">
												<a>
													<span class="glyphicon glyphicon-file">
													</span>Old Date Of Birth Proof
												</a>
											</h4>
										</div>
										<iframe src="" frameborder="0" id="dateofbirthproofold" style="width: 100%; height: 300px;"></iframe>
									</div>
								</div>
								<div class="col-md-6">
									<table class="table table-bordered">
										<thead>
											<tr>
												<th colspan="2">New Date Of Birth Details</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td>Date of Birth</td>
												<td><label id="lblOldBeneDOB"></label></td>
											</tr>
										</tbody>
									</table>
									<div class="panel panel-default">
										<div class="panel-heading">
											<h4 class="panel-title">
												<a>
													<span class="glyphicon glyphicon-file">
													</span>New Date Of Birth Proof
												</a>
											</h4>
										</div>
										<iframe src="" frameborder="0" id="dateofbirthproofnew" style="width: 100%; height: 300px;"></iframe>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<div style="display:none;margin-right:66px;margin-bottom:-34px;" id="divStstus">
									<a id="AgentApp" class="btn btn-success" onclick="SubmitStatus('1')">Approve</a>
									<a class="btn btn-danger" href="#" data-toggle="modal" data-target="#divEditDetRej">Reject</a>
								</div>
								<div id="divlbl" style="display:none;">
									<label id="lblrefid"></label>
								</div>
								<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							</div>
						</div>
					</center>
				</div>
			</div>*@




		<!-- Modal -->
		@*<div class="modal fade" id="divEditDetRej" role="dialog">
				<div class="modal-dialog modal-sm">

					<div class="modal-content" style="width:580px;margin-left:-580px;">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Remarks</h4>
						</div>
						<div class="modal-body">
							<div class="row">
								<div class="col-md-4">
									<div class="form-group">
										<div class="input-group extra-space">
											<textarea name="test_field" id="RejectedRemarks" style="width: 544px;height: 104px;"></textarea>
										</div>
									</div>
								</div>

							</div>
						</div>
						<div class="modal-footer">
							<a class="btn btn-success" onclick="SubmitStatus('2')">Submit</a>
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>*@
	</form>

</div>





<script>
    $(document).ready(function () {
            $('.Apllications').DataTable({
        });

        getdates();
        GetReport()
        });

    function GetReport() {
        var fromdate = $('#fromdate').val();
        var todate = $('#todate').val();
        var Staus = $("#Status").val();



		$.get('@Url.Action("GetDOBEditAppliation", "Report")', { userId: deptuserid, fromDate: fromdate, toDate: todate, Status: $("#Status").val() }, function (result) {
             
            var table = $('.Apllications').DataTable();
            table.destroy();
            $('.Apllications tbody').empty();
            $.each(result, function (i, data) {
                var num = i + 1;
                 
                $('.Apllications').append('<tr><td>' + data.Sno + '</td><td><a href="#" data-toggle="modal"  onClick = "GetBenDet('+ data.Id +');" id=' + data.Name + '>' + data.Name + '</a></td><td>' + data.SSIN+'</td><td>' + data.ReqDate + '</td><td>' + data.Status + '</td><td>'+data.Remarks+'</td></tr>')
            });
            $('.Apllications').DataTable({
            });

        });
    }


    function getdates() {
		$("#fromdate,#todate,#registrationdate").datepicker({
            dateFormat: "dd-mm-yy",
            changeYear: true,
            yearRange: "1960:2020",
            autoclose: true,
            maxDate: new Date()
        })
        var dat = new Date();
        var month = (dat.getMonth() + 1) < 10 ? '0' + (dat.getMonth() + 1) : '' + (dat.getMonth() + 1);
        var day = (dat.getDate()) < 10 ? '0' + (dat.getDate()) : '' + (dat.getDate());
        var today = day + "-" + month + "-" + dat.getFullYear();

		$("#fromdate,#todate,#registrationdate").val(today);
    }

    @*function GetBenDet(Id) {

		$.get('@Url.Action("GetDOBEditAppliationById", "Report")', { id: Id }, function (result) {
			 

			if (result.Status == "Pending") {
				$("#divStstus").show();
			}
			else {

				$("#divStstus").hide();

			}
			//New Details
			//$("#lblNewBeneFirstName").text(result.NewFirstName);
			//$("#lblNewBeneLastName").text(result.NewLastName);
			//$("#lblNewBeneMiddleName").text(result.NewMiddleName);
			$("#lblNewBeneDOB").text(result.NewBenDOB);

			//Old Details
			//$("#lblOldBeneFirstName").text(result.OldFirstName);
			//$("#lblOldBeneLastName").text(result.OldLastName);
			//$("#lblOldBeneMiddleName").text(result.OldMiddleName);
			$("#lblOldBeneDOB").text(result.OldBeneDOB);
			 
			////alert('name ext ' + result.NameProofExtension);
			////alert('dob ext ' + result.DOBProofExtension);
			//if (result.NameProofExtension == "pdf")
			//	$("#dateofbirthproofold").attr('src', 'data:application/' + result.NameProofExtension + ';base64,' + result.NameProof); //for pdf file
			//else
			//$("#ImgRejectedDoc").attr('src', res.RejectedDocumnet);
			$("#dateofbirthproofold").attr('src', result.OldDOBProof);
			//alert(result.DOBProofExtension);
			//alert(result.DOBProof);
			if (result.DOBProofExtension == "pdf")
				$("#dateofbirthproofnew").attr('src', 'data:application/' + result.DOBProofExtension + ';base64,' + result.DOBProof); //for pdf file
			else {
				$("#dateofbirthproofnew").attr('src', 'data:image/' + result.DOBProofExtension + ';base64,' + result.DOBProof); //for pdf file
				//$("#dateofbirthproof").attr('src', 'data:images/jpg;base64,' + result.DOBProof); //for image file
				//$("#dateofbirthproof").attr('src', 'data:image/jpg; base64,'+ result.DOBProof);

		}
		//$("#nameidproof").attr('src', 'data:images/jpeg;base64,'+result.NameProof); //for image file
		//$("#dateofbirthproof").attr('src', result.DOBProof);



		$("#DivBenPersonalDet").modal('show');

            $("#lblrefid").text(Id);

        });


    }*@

	$('INPUT[type="file"]').change(function () {
		 

		var fname = "";

		if (this.id == "Photo") {
			fname = "photo";
		}
		if (this.id == "Signature") {
			fname = "signature";
		}


		if (this.id == "Photo" || this.id == "Signature") {
			if (this.files[0].size < 2000000) {
				var ext = this.value.match(/\.(.+)$/)[1];
				switch (ext) {
					case 'jpg':
					case 'jpeg':
					case 'png':
					case 'JPG':
					case 'JPEG':
					case 'PNG':
						break;
					default:

						alert('Please choose ' + fname + ' only jpg,jpeg or png,pdf File');

						this.value = '';
						this.focus();
				}
			}
			else {
				alert('Please choose size of ' + fname + ' file below 2MB');
				this.value = '';
				this.focus();
			}
		}

    });

    function GetBenRenwlDet() {

        if ($("#benssinumber").val() == "" || $("#benssinumber").val() == null ) {
            alert("Please Enter SSI Number");
            $("#benssinumber").focus();
            return false;
        }

        $.get('@Url.Action("GetEdistConstructionDetails", "Registration")', { bensno: $("#benssinumber").val() }, function (res) {

            if (res.ResCode == "000") {
                $("#ssinumberdet").val($("#benssinumber").val());
				$("#Beneficiaryname").val(res.Data.BENEFICIARY_NAME);
                $("#regnumber").val(res.Data.NEW_REGISTRATION_NO);
				$("#receiptbookno").val(res.Data.RECEIPT_BOOK_NUMBER);
				$("#Receiptno").val(res.Data.RECEIPTPAGENUMBER);
                $("#dobproofdoc").val('');
                }
                else {
                alert("Unfortunately, we couldn't find your records in our system.");
                $("#ssinumberdet").val('');
                $("#Beneficiaryname").val('');
                $("#regnumber").val('');
                $("#receiptbookno").val('');
                $("#Receiptno").val('');
                $("#dobproofdoc").val('');
                    return false;
                }

            });


    }

    function FinalSubmit() {

        if ($("#ssinumberdet").val() == "" || $("#ssinumberdet").val() == null) {
            alert("Please Enter SSI Number");
            $("#ssinumberdet").focus();
            return false;
        }
        if ($("#Beneficiaryname").val() == "" || $("#Beneficiaryname").val() == null) {
            alert("Please Enter Beneficiary Name");
            $("#Beneficiaryname").focus();
            return false;
        }
        if ($("#regnumber").val() == "" || $("#regnumber").val() == null) {
            alert("Please Enter Registration Number");
            $("#regnumber").focus();
            return false;
        }
        if ($("#receiptbookno").val() == "" || $("#receiptbookno").val() == null) {
            alert("Please Enter Receipt Book Number");
            $("#receiptbookno").focus();
            return false;
        }
        if ($("#Receiptno").val() == "" || $("#Receiptno").val() == null) {
            alert("Please Enter Receipt Number");
            $("#Receiptno").focus();
            return false;
        }
        if ($("#registrationdate").val() == "" || $("#registrationdate").val() == null) {
            alert("Please select Registration Date");
            $("#registrationdate").focus();
            return false;
		}
		if ($("#ReceiptAmount").val() == "" || $("#ReceiptAmount").val() == null) {
			alert("Please select Receipt Amount");
			$("#ReceiptAmount").focus();
			return false;
		}
		//ReceiptAmount
        if ($("#dobproofdoc").val() == "" || $("#dobproofdoc").val() == null) {
            alert("Please Upload Scheme Certificate");
            $("#dobproofdoc").focus();
            return false;
        }

        if ($("#ReceiptAmount").val() == "" || $("#ReceiptAmount").val() == null || $("#ReceiptAmount").val() == 0) {
            alert("Please Enter Receipt Amount");
            $("#ReceiptAmount").focus();
            return false;
        }

        var form = $('#additionalInformation')[0];
        var data = new FormData(form);

        $.ajax({
            url: '/Registration/TransWrkrNewUserRenewelApplications',
            type: 'post',
            enctype: 'multipart/form-data',
            processData: false,  // Important!
            contentType: false,
            cache: false,
            data: data,
            success: function (Res) {
                alert(Res.Message);
                if (Res.Code == "000") {
                    window.location.href = "/Report/TransWrkrNewUserRenewelApplications";
                }
            }
        });


    }

    function SubmitStatus(id)
    {

		if ($("#dobproofdoc").val() == "" || $("#dobproofdoc").val() == null || $("#dobproofdoc").val() == 0) {
			alert("Please Upload DOB Proof");
			$("#dobproofdoc").focus();
			return false;
		}

        var refid = $("#lblrefid").text();
        var Remarks =  $("#RejectedRemarks").val();
        if(id == 2)
        {
            if(Remarks == "" || Remarks == null)
            {
                alert("Please Enter Remarks.");
                $("#RejectedRemarks").focus();
                return false;
            }
        }
        if(id == 1)
            Remarks = "";
         $.get('@Url.Action("VerifyBeneDOBDetails", "Report")', { id: refid, Remarks: Remarks, Status: id}, function (res) {
            alert(res.Message);
			 window.location.href = " /Report/EditBeneDOBDetApplications";

        });
    }
</script>


