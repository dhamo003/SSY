@model SSY.Models.Reports
@{
    ViewBag.Title = "LegacyDataReport";
    Layout = "~/Views/Shared/_LocDashoardLayout.cshtml";
}
<link href="~/Content/ssy_css/smoothness.jquery-ui.css" rel="stylesheet" />
<link href="~/Content/my_css/dataTables.jqueryui.min.css" rel="stylesheet" />


<link href="~/Content/ssy_css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="~/Content/ssy_css/font-awesome.min.css" rel="stylesheet" />

<script src="~/Content/ssy_js/jquery.js"></script>
<script src="~/Content/ssy_js/jquery.dataTables.min.js"></script>
<script src="~/Content/ssy_js/dataTables.jqueryui.min.js"></script>

<script src="~/Content/ssy_js/bootstrap-multiselect.js"></script>
<link href="~/Content/ssy_css/bootstrap-multiselect.css" rel="stylesheet" />
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

<script>
    var UserTypeid = @Html.Raw(Json.Encode(ViewBag.usertype))
    var Deptid = @Html.Raw(Json.Encode(ViewBag.deptid))
    var RepSubDVision ="";
    var RepLocation ="";
    var SendSubDiv ="";
    var SendLocation ="";

    var path ="";
    var ValuSend = "";
    var SelUserid = 0;
</script>
<style>
    #fromdate, #todate {
        /*position:absolute;*/
        z-index: 1000;
    }

    .Dropdwn {
        width: 185px;
        height: 33px;
    }

    th {
        font-size: 13px;
    }

    td {
        font-size: 13px;
    }

    .dt-buttons a {
        background: #8BC34A !important;
    }

    .dropdown-toggle, .dropdown-menu {
        width: 200px !important;
    }

    .dropdown-menu {
        position: absolute;
        z-index: 9999;
        max-height: 250px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .dettable {
        overflow-x: scroll;
        overflow-y: hidden;
    }

    .dataTables_filter {
        display: none;
    }
    .dataTables_processing 
        {
            background-color: green !important;
            color : black !important;
            border-color : white !important;
        }

    .dataTables_info {
        display : none !important;
    }
    


</style>
<div class="container-fluid" id="sign">
    <marquee scrollamount="7"><font color="green" size="3"><b>Report can be viewed for a date range of one month,if date range is more than one month please click on download.</b></font></marquee>


    <div class="logo" style="text-align: center;"><h3><b>Legacy Data Report</b></h3></div>
    <div class="col-sm-12">
        <div class="col-md-3">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">District</span>
                    @Html.DropDownListFor(m => m.disid, new SelectList(Model.district, "Value", "Text"), new { @class = "form-control", @tabindex = "6" })
                </div>
            </div>
        </div>
        <div class="col-md-3" id="divsub">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">Sub Division</span>
                    @Html.DropDownListFor(m => m.subdivid, new SelectList(Model.subdivision, "Value", "Text"), new { @class = "form-control", @tabindex = "7" })
                </div>
            </div>
        </div>
        <div class="col-md-3" id="divloc">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">Location</span>
                    @Html.DropDownListFor(m => m.muncorp, new SelectList(Model.muncorpname, "Value", "Text"), new { @class = "form-control Location", id = "Location", @tabindex = "8" })
                </div>
            </div>
        </div>


        <div class="col-md-3">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">Worker Type</span>
                    @Html.DropDownList("schemeid", new List<SelectListItem>
                                        {
                                             new SelectListItem{ Text="-- Select Worker Type --", Value = "0" },
                                              new SelectListItem{ Text="ALL", Value = "ConstructionWorker,TransportWorker,Others" },
                                            new SelectListItem{ Text="Construction Worker", Value = "ConstructionWorker" },
                                             new SelectListItem{ Text="Transport Worker", Value = "TransportWorker" },
                                              new SelectListItem{ Text="Other Worker", Value = "Others" }
                                        }, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">Status</span>
                    @Html.DropDownList("SchemeStatus", new List<SelectListItem>
                                        {
                                              new SelectListItem{ Text="ALL", Value = "0,1,2,3" },
                                            new SelectListItem{ Text="Approved", Value = "1" },
                                             new SelectListItem{ Text="Pending", Value = "0" },
                                              new SelectListItem{ Text="Rejected", Value = "2" },
                                              new SelectListItem{ Text="SendBack", Value = "3" }
                                        }, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">From Date</span>
                    @Html.TextBoxFor(m => m.fromdate, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="form-group">
                <div class="input-group extra-space">
                    <span class="input-group-addon input-label">To Date</span>
                    @Html.TextBoxFor(m => m.todate, new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="col-md-3">
        <a class="btn btn-primary" onclick="GetRepData()">Submit</a>
        <a class="btn btn-primary" style="margin-left: 10px;" onclick="GetDwnld()">Download</a>
        </div>

    </div>
    @*<center><b> Note :  </b></center>*@

    <div class="row">

        <div class="row">
            <div class="col-md-12 column">
                <div class="container-fluid">

                    <iframe name="ifr" id="ifr" style="width: 100%;height:500px; position: relative; border: none; margin-bottom:5%;margin-left:50px;margin-right:150px;padding-right:50px; max-height: 400px;overflow-y:auto; border-radius: 0px; "></iframe>
                </div>
            </div>
        </div>
    </div>
</div>
<div>
  

   

</div>

<script>
    $(document).ready(function () {

        getdates();

        $('.detailedAppl').DataTable({

            dom: 'Bfrtip'
        });


		if (UserTypeid == 1 || UserTypeid == 5 || UserTypeid == 24)
            tblheader = "District : " + $("#disid option:selected").text() + " , " + " Sub Division : " + $("#subdivid option:selected").text() + " , " + " Location : " + $("#Location option:selected").text() + "\n\n" +  " Worker Type : " + $("#schemeid option:selected").text() + ", Status : " + $("#SchemeStatus option:selected").text() + "\n\n" + " From Date : " + $("#fromdate").val() + " , " + " To Date :" + $("#todate").val();
        if (UserTypeid == 7 || UserTypeid == 3 || UserTypeid == 4)
            tblheader = "District : " + $("#disid option:selected").text() + "\n\n"  + " Worker Type : " + $("#schemeid option:selected").text() + ", Status : " + $("#SchemeStatus option:selected").text() + "\n\n" + " From Date : " + $("#fromdate").val() + "  " + ", To Date : " + $("#todate").val();
        if (UserTypeid == 6)
            tblheader = "District : " + $("#disid option:selected").text() + " , " + " Sub Division : " + $("#subdivid option:selected").text() + " , " + " Location : " + $("#Location option:selected").text() + "\n\n"  + " Worker Type : " + $("#schemeid option:selected").text() + ", Status : " + $("#SchemeStatus option:selected").text() + "\n\n" + " From Date : " + $("#fromdate").val() + "  " + ", To Date : " + $("#todate").val();

      $('th').css("background", "#094c86");
      $('th').css("color", "#ffffff");


        if (UserTypeid == 6) {
            $("#disid").attr("disabled", true);
        }
        if (UserTypeid == 7 || UserTypeid == 3 || UserTypeid == 4) {
            $("#divloc").hide();
            $("#divsub").hide();
        }
        if (UserTypeid == "5") {
             
            $.get('@Url.Action("GetMultipleLoca", "Registration")', { Uid: Deptid }, function (dat) {
                $("#Location").find("option").remove();
                $("#Location").append("<option value=-1> " + "ALL" + " </option>");
                RepLocation = "";
                $.each(dat, function (i, data) {
                     
                    $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                    RepLocation += data.Value + ",";
                });
            });
        }
        if (UserTypeid == "6") {
            $.get('@Url.Action("GetMultipleSubDiv", "Registration")', { Uid: Deptid }, function (dat) {
                $("#subdivid").find("option").remove();
                $("#subdivid").append("<option value=-1> " + "ALL" + " </option>");
                RepSubDVision = "";
                $.each(dat, function (i, data) {
                     
                    $("#subdivid").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                    RepSubDVision += data.Value + ",";
                });
                if (UserTypeid == "6") {
                    GetAlcLocations()
                }
            });
        }
        if (UserTypeid == "7" || UserTypeid == "3" || UserTypeid == "4") {
            $.get('@Url.Action("GetMultipleDistricts", "Registration")', { Uid: Deptid }, function (dat) {
                 
                var disticts = "";
                $("#disid").find("option").remove();
                $("#disid").append("<option value=0> " + "Select District" + " </option>");
                $.each(dat, function (i, data) {
                    $("#disid").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                });
            });
        }
    })
    function GetRepData() {

		if (UserTypeid == 1 || UserTypeid == 2 || UserTypeid == 24) {
            if ($("#disid").val() == "" || $("#disid").val() == null || $("#disid").val() == "0") {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == "" || $("#subdivid").val() == null || $("#subdivid").val() == "0") {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == "" || $("#Location").val() == null || $("#Location").val() == "0") {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 5) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == 0 || $("#subdivid").val() == "" || $("#subdivid").val() == null) {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == 0 || $("#Location").val() == "" || $("#Location").val() == null) {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 6) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == 0 || $("#subdivid").val() == "" || $("#subdivid").val() == null) {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == 0 || $("#Location").val() == "" || $("#Location").val() == null) {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 7 || UserTypeid == 3 || UserTypeid == 4) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }

        // Date validations
        var arr1 = $('#fromdate').val().split('-');
        var arr2 = $('#todate').val().split('-');
        var startDate = new Date(arr1[1] +"-"+arr1[0] + "-"+arr1[2]);
        var endDate = new Date(arr2[1] +"-"+arr2[0] + "-"+arr2[2]);

        // alert(endDate - startDate);

        var diffDate = (endDate - startDate)/1000/60/60/24;

        //alert(diffDate);

        if (diffDate > 31 || diffDate < 0){

            alert("Report can be viewed for a date range of one Month");

            return false;

        }
       
        ValuSend = "";
        SendSubDiv = "";
        SendLocation = "";
        if ($("#subdivid").val() == "-1") {
            SendSubDiv = RepSubDVision;
        }
        else {
            SendSubDiv = $("#subdivid").val();
        }
        if ($("#Location").val() == "-1") {
            SendLocation = RepLocation;
        }
        else {
            SendLocation = $("#Location").val();
        }


        var table = $('.detailedAppl').DataTable();
        table.destroy();
        $('.detailedAppl tbody').empty();


          var url = "/SSYIDCard/LegacyReport.aspx?Districtid=" + $("#disid").val() + "&Subdivid=" + SendSubDiv+ "&Locid=" + SendLocation+ "&Fromdate=" + $("#fromdate").val()+"&Todate=" + $("#todate").val()+"&schemeid=" + $("#schemeid").val()+"&SchemeStatus=" + $("#SchemeStatus").val();


        $('iframe#ifr').attr('src', url);

    
        $("#sign").show();

     

    }


    function getdates() {
        $("#fromdate,#todate").datepicker({
            dateFormat: "dd-mm-yy",
            changeYear: true,
            yearRange: "1960:2020",
            autoclose: true,
            maxDate: new Date()
        })
        var dat = new Date();
        var month = (dat.getMonth() + 1) < 10 ? '0' + (dat.getMonth() + 1) : '' + (dat.getMonth() + 1);
        var day = (dat.getDate()) < 10 ? '0' + (dat.getDate()) : '' + (dat.getDate());
        var today = day + "-" + month + "-" + dat.getFullYear();
        $("#fromdate,#todate").val(today);
    }
    //Get Detailed Report
    //Load Subdivision
    $("#disid").change(loadSubdiv);
    function loadSubdiv() {
        $.get('@Url.Action("GetSubdivisionJSON", "Login")', { ID: $("#disid").val() }, function (dat) {
            $("#subdivid").find("option").remove();
            $("#subdivid").append("<option value=-1>ALL</option>");
            RepSubDVision = "";
            $.each(dat, function (i, data) {
                 
                if (data.Value != "0")
                    $("#subdivid").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                RepSubDVision += data.Value + ",";
            });
        });
        // get blocks
        $.get('@Url.Action("GetblockforDisRepJSON", "Report")', { ID: $("#disid").val() }, function (dat) {
             
            $("#Location").find("option").remove();
            RepLocation = "";
            $.each(dat, function (i, data) {
                 
                $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                RepLocation += data.Value + ",";
            });
        });
    }
    //Load Blocks
    $("#subdivid").change(loadBlock);
    function loadBlock() {
         
        var val = $("#subdivid").val();
        if (val == "-1") {
            GetAlcLocations()
        }
        else {
            $.get('@Url.Action("GetblockforSubRepJSON", "Report")', { ID: $("#subdivid").val() }, function (dat) {
                 
                $("#Location").find("option").remove();
                $("#Location").append("<option value=-1>ALL</option>");
                RepLocation = "";
                $.each(dat, function (i, data) {
                     
                    if (data.Value != "0")
                        $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                    RepLocation += data.Value + ",";
                });
            });
        }
    }


    //Load Alc Locations
    function GetAlcLocations() {
        $.get('@Url.Action("GetBlocksBySubDivision", "Report")', { ID: RepSubDVision }, function (dat) {
             
            $("#Location").find("option").remove();
            RepLocation = "";
            $.each(dat, function (i, data) {
                 
                $("#Location").append("<option value=" + data.Value + "> " + data.Text + " </option>");
                RepLocation += data.Value + ",";
            });
        });
    }

    $(".getSearchDet").click(function () {
         
        var value = $(".searchval").val();

        if (value == "" || value == null) {
            alert("Please Enter SSIN Number/Scheme Registration.");
            return false;
        }

        GetRepData()
    })
    function GetDwnld(){

		if (UserTypeid == 1 || UserTypeid == 2 || UserTypeid == 21 || UserTypeid == 22 || UserTypeid == 24) {
            if ($("#disid").val() == "" || $("#disid").val() == null || $("#disid").val() == "0") {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == "" || $("#subdivid").val() == null || $("#subdivid").val() == "0") {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == "" || $("#Location").val() == null || $("#Location").val() == "0") {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 5) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == 0 || $("#subdivid").val() == "" || $("#subdivid").val() == null) {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == 0 || $("#Location").val() == "" || $("#Location").val() == null) {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 6) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }
            if ($("#subdivid").val() == 0 || $("#subdivid").val() == "" || $("#subdivid").val() == null) {
                alert("Please Select SubDivision");
                $("#subdivid").focus();
                return false;
            }
            if ($("#Location").val() == 0 || $("#Location").val() == "" || $("#Location").val() == null) {
                alert("Please Select Location");
                $("#Location").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }
        if (UserTypeid == 7 || UserTypeid == 3 || UserTypeid == 4) {
            if ($("#disid").val() == 0 || $("#disid").val() == "" || $("#disid").val() == null) {
                alert("Please Select District");
                $("#disid").focus();
                return false;
            }

            if ($("#schemeid").val() == "" || $("#schemeid").val() == null || $("#schemeid").val() == "0") {
                alert("Please Select Worker Type");
                $("#schemeid").focus();
                return false;
            }
        }

 
         

        ValuSend = "";
        SendSubDiv = "";
        SendLocation = "";
        if ($("#subdivid").val() == "-1") {
            SendSubDiv = RepSubDVision;
        }
        else {
            SendSubDiv = $("#subdivid").val();
        }
        if ($("#Location").val() == "-1") {
            SendLocation = RepLocation;
        }
        else {
            SendLocation = $("#Location").val();
        }


        $.get('@Url.Action("DwnldSaveLegacyData", "Report")', {Districtid: $("#disid").val(), Subdivid: SendSubDiv, Locid: SendLocation, Fromdate: $("#fromdate").val(), Todate: $("#todate").val(), schemeid: $("#schemeid").val(), SchemeStatus: $("#SchemeStatus").val(),Deptuserid : Deptid,ReportName : "Legacy Data Report"}, function (result) {

            alert(result);
        })


    }

    function IsAlphaNumaric(e) {
        if ((e.keyCode >= 186 && e.keyCode <= 188) || (e.keyCode == 190) || e.keyCode == 191 ||
    e.keyCode == 192 || e.keyCode == 109 || (e.keyCode >= 219 && e.keyCode <= 222) || (e.keyCode >= 110 && e.keyCode <= 111) ||
    (e.keyCode >= 106 && e.keyCode <= 107) || e.keyCode == 59 || e.keyCode == 189 || e.keyCode == 61 || e.keyCode == 173 ||
    ((e.keyCode >= 48 && e.keyCode <= 57)  && e.shiftKey == true)) {
            return false;
        }
    }

    $('#btnPaging').click(function () {
        var val = $('#txtPaging').val();
        if (val != "" && val != 0) {

            val = val - 1;
            var table = $('.detailedAppl').DataTable();
            table.page(parseInt(val)).draw('page');
        }
        else {
            alert('Requested page number not valid');
            $('#txtPaging').focus();
        }
    });

</script>
